/******************************************************************************
  Brief   : manages and contains all information about the 3D object
  Name    : Cody Morgan
  Date    : 16 DEC 2019
******************************************************************************/

#pragma once
#ifndef OBJECT_H
#define OBJECT_H

#include <GL/glew.h>
#include <glm/gtc/type_ptr.hpp>
#include <glm/gtc/matrix_transform.hpp>

#include <string>
#include <vector>

class Vertex
{
public:
  Vertex(glm::vec3 pos);

  glm::vec3 position;
  glm::vec3 normal;
  // UV's will be generated by the GPU
};

struct BoundingBox
{
  glm::vec3 min;
  glm::vec3 max;
};

class Object
{
  public:
    Object(std::string ID = "anon");

    // object shape
    void loadOBJ(std::string location);
    void loadeCube(float radius);
    void loadSphere(float radius, int divisions);
    void loadCircle(float radius, int divisions, glm::vec3 axis = glm::vec3(0,1,0));
    void loadPlane(float radius);
    void loadTexture(std::string location, int slot = 0);

    // object manipulation
    void translate(glm::vec3 trans);
    void rotate(float degrees, float radius, glm::vec3 axis = glm::vec3(0,1,0));
    void scale(glm::vec3 scale);

    void draw();

    // public data
    std::string name;
    bool wiremode = false;

    // Getters

    // Setters

  private:

    // object data
    BoundingBox boundingBox;
    glm::mat4 pretransform = glm::mat4(1.0f); // used mostly for rotating 
    glm::mat4 modelToWorld = glm::mat4(1.0f);
    std::vector<Vertex> vertices;
    std::vector<glm::vec3> faceNormals;
    unsigned renderMode = GL_TRIANGLES;

    // openGL stuff
    int shaderProgram_ = -1;
    unsigned vbo_ = 0;
    unsigned vao_ = 0;
    unsigned ebo_ = 0;
    unsigned fbo_ = 0;
    unsigned rbo_ = 0;

    // object functions
    void initBuffers();

    // uniform locations
    int textureCountLoc = -1;
    int modelToWorldLoc = -1;
};

class ObjectManager
{
  public:
    static ObjectManager getObjectManager();

    void update();
    void render();
    std::vector<Object*> getObjectsByName(std::string name);
    
  private:
    ObjectManager();
};

#endif